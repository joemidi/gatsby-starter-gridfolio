"use strict";backgrounds.Photo=new Model({data:{id:null},linkUrl:"",linkTitle:"",backgroundObjects:[],init:function(){this.$background=$(".background__image"),this.$location=$(".content__location"),this.$locationRegion=$(".content__location__region"),this.$locationCountry=$(".content__location__country"),this.$attributionText=$(".content__attribution__text");for(var t=this,e=0;e<earthview.config.IMAGE_IDS.length;e++)t.requestImage(earthview.config.IMAGE_IDS[e]).then(function(e){var i=document.createElement("div");return i.style.backgroundImage="url("+e.dataUri+")",i.style.backgroundPosition="50% 50%",i.style.backgroundRepeat="no-repeat",i.style.width="1070px",i.style.height="350px",i.style.position="absolute","1057"!==e.id&&(i.style.opacity=0,i.style.visibility="hidden"),i.id="image-"+e.id,t.$background.appendChild(i),t.backgroundObjects.push(e),e},t.error).then(function(e){e.id==earthview.config.IMAGE_IDS[0]&&t.updateImageData(e)},t.error);Object.observe(this,function(t){"data"===t[0].name&&this.render()}.bind(this))},show:function(t){if(t){var e=this.grep(this.backgroundObjects,function(e){if(e.id==t)return e.id});this.updateImageData(e)}},grep:function(t,e){var i=[],a=t.length,n=0;for(n;n<a;n++){var o=t[n];e(o)&&i.push(o)}return i[0]},getId:function(){return this.data.id},saveImage:function(t){this.data.id||this.updateImageData(t)},updateImageData:function(t){this.nextImage&&this.nextImage!==t.id||(this.data=t,this.nextImage=!1)},requestImage:function(t){return new Promise(function(e,i){var a=new XMLHttpRequest;a.open("GET",earthview.config.IMAGE_BASE_URL+t+".json",!0),a.onload=function(){200===a.status?e(JSON.parse(a.response)):i(a.statusText)},a.send()})},render:function(){var t=earthview.config.MAPS_LINK.replace("{{lat}}",this.data.lat).replace("{{lng}}",this.data.lng).replace("{{zoom}}",this.data.zoom+1||11),e=(earthview.config.BASE_URL,this.data.id,this.data.geocode.country||""),i=this.data.geocode.locality||this.data.geocode.administrative_area_level_2||this.data.geocode.administrative_area_level_1||"",a="See "+i+", "+e+" on Google Maps";this.linkUrl=t,this.$attributionText.textContent=this.data.attribution,this.$location.setAttribute("href",t),this.$location.setAttribute("title",a),this.$locationRegion.textContent=i,this.$locationCountry.innerHTML=e||"&nbsp;",this.trigger("show",this.data)}});